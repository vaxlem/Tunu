<!DOCTYPE html>
<html>
<head>
  <title>Button Example</title>
  <style>
    #myAudio {
      display: none;
    }
  </style>
</head>
<body>
  <h2 style="background-color: beige;" id="textToRead">I am TAY Lakle. your great great grandfather. My father is called EHA ASHIAPIM - 1st (Priest Eha Ashiapim l). (DO YOU KNOW MY REAL NAME?) OH! Ok. My real name is TAY EHA.</h2>

  <audio id="myAudio">
    <source src="./RECORD20210107203253.3gpp" type="audio/mpeg">
  </audio>

  <button onclick="toggleAudio()">Play / Pause</button>
  <button onclick="stopAudio()">Stop</button>
  <button onclick="resumeAudio()" disabled id="resumeButton">Resume</button>

  <script>
    var audio = document.getElementById("myAudio");
    var textToRead = document.getElementById("textToRead").innerText;
    var isPaused = true;
    var resumePosition = 0;

    function toggleAudio() {
      if (audio.paused) {
        if (isPaused) {
          speakText();
          isPaused = false;
        }
        audio.play();
        document.getElementById("resumeButton").disabled = true;
      } else {
        audio.pause();
        isPaused = true;
        document.getElementById("resumeButton").disabled = false;
        stopTextToSpeech(); // Stop text-to-speech
      }
    }

    function stopAudio() {
      audio.pause();
      audio.currentTime = 0;
      resumePosition = 0; // Reset the resume position
      isPaused = true;
      document.getElementById("resumeButton").disabled = false;
      stopTextToSpeech(); // Stop text-to-speech
    }

    function resumeAudio() {
      audio.currentTime = resumePosition; // Resume from the stored position
      audio.play();
      document.getElementById("resumeButton").disabled = true;
      speakText();
    }

    audio.onended = function() {
      audio.currentTime = 0;
      audio.play();
      speakText();
    };

    function speakText() {
      const message = new SpeechSynthesisUtterance(textToRead);
      window.speechSynthesis.cancel(); // Cancel any ongoing speech synthesis
      window.speechSynthesis.speak(message);
    }
    
    function stopTextToSpeech() {
      window.speechSynthesis.cancel(); // Cancel any ongoing speech synthesis
    }
    
    audio.ontimeupdate = function() {
      resumePosition = audio.currentTime; // Update the resume position
    };
  </script>
</body>
</html>
